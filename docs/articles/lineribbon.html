<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lineribbon stats and geoms • ggdist</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Lineribbon stats and geoms">
<meta property="og:description" content="ggdist">
<meta property="og:image" content="http://mjskay.github.io/ggdist/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93322-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93322-5');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggdist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/freq-uncertainty-vis.html">Frequentist uncertainty visualization</a>
    </li>
    <li>
      <a href="../articles/lineribbon.html">Lineribbon stats and geoms</a>
    </li>
    <li>
      <a href="../articles/slabinterval.html">Slab + interval stats and geoms</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mjskay/ggdist/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lineribbon_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="lineribbon_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="lineribbon_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lineribbon stats and geoms</h1>
                        <h4 class="author">Matthew Kay</h4>
            
            <h4 class="date">2020-11-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mjskay/ggdist/blob/master/vignettes/lineribbon.Rmd"><code>vignettes/lineribbon.Rmd</code></a></small>
      <div class="hidden name"><code>lineribbon.Rmd</code></div>

    </div>

    
    
<style type="text/css">
.kable-table table {
  margin-left: 0;
}
img {
  border: none;
}
</style>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The following vignette describes the <code><a href="../reference/geom_lineribbon.html">geom_lineribbon()</a></code> family of stats and geoms in <code>ggdist</code>, a family of stats and geoms for creating line+ribbon plots: for example, plots with a fit line and one or more uncertainty bands. This vignette also describes the <code><a href="../reference/curve_interval.html">curve_interval()</a></code> function for calculating curvewise (joint) intervals for lineribbon plots.</p>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>The following libraries are required to run this vignette:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/">ggdist</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.mitchelloharawild.com/distributional/">distributional</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="../reference/theme_ggdist.html">theme_ggdist</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="the-lineribbon-family" class="section level2">
<h2 class="hasAnchor">
<a href="#the-lineribbon-family" class="anchor"></a>The lineribbon family</h2>
<p>The lineribbon family follows the same naming scheme as the larger family of slabinterval geoms (see <code><a href="../articles/slabinterval.html">vignette("slabinterval")</a></code>). It has three members: <code><a href="../reference/geom_lineribbon.html">geom_lineribbon()</a></code>, <code><a href="../reference/stat_lineribbon.html">stat_lineribbon()</a></code>, and <code><a href="../reference/stat_lineribbon.html">stat_dist_lineribbon()</a></code>.</p>
<ul>
<li>
<code><a href="../reference/geom_lineribbon.html">geom_lineribbon()</a></code> is meant to be used on data already summarized into points and intervals.</li>
<li>
<code><a href="../reference/stat_lineribbon.html">stat_lineribbon()</a></code> is meant to be used on sample data; e.g. draws from a posterior distribution of lines/curves, a bootstrap sampling distribution of lines/curves, an ensemble distribution, or any other distribution, really. This stat computes relevant summaries (points and intervals) before forwarding the summaries to <code><a href="../reference/geom_lineribbon.html">geom_lineribbon()</a></code>.</li>
<li>
<code><a href="../reference/stat_lineribbon.html">stat_dist_lineribbon()</a></code> can be used to create lineribbon geoms for analytical distributions. It takes either <a href="https://pkg.mitchelloharawild.com/distributional/">distributional</a> objects or distribution names (the <code>dist</code> aesthetic) and arguments (the <code>args</code> aesthetic or <code>arg1</code>, … <code>arg9</code> aesthetics) and compute the relevant slabs and intervals.</li>
</ul>
<p>All lineribbon geoms can be plotted horizontally or vertically. Depending on how aesthetics are mapped, they will attempt to automatically determine the orientation; if this does not produce the correct result, the orientation can be overridden by setting <code>orientation = "horizontal"</code> or <code>orientation = "vertical"</code>.</p>
</div>
<div id="lineribbons-on-already-summarized-data" class="section level2">
<h2 class="hasAnchor">
<a href="#lineribbons-on-already-summarized-data" class="anchor"></a>Lineribbons on already-summarized data</h2>
<p>The base lineribbon geometry can only be applied to already-summarized data: data frames where each row contains a point and the upper and lower bounds of an interval. For the purposes of this example, we will first look at how to generate such a data frame from a data frame of sample data; such data could include Bayesian posterior distributions (for examples of this usage, see vignettes in <a href="https://mjskay.github.io/tidybayes/">tidybayes</a>) or bootstrap sampling distributions. For the simple example here, we’ll just generate a distribution of lines manually:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">n</span> <span class="op">=</span> <span class="fl">5000</span>

<span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  .draw <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>,
  intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>,
  slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">intercept</span>, <span class="va">slope</span>, <span class="op">~</span> <span class="va">.x</span> <span class="op">+</span> <span class="va">.y</span> <span class="op">*</span> <span class="op">-</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><code>df</code> is a 50,000-row data frame with a sample of 5000 y values for each x value. It represents a sample of 5000 lines. Here is a subsample of 100 of the lines:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.draw</span> <span class="op">%in%</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, group <span class="op">=</span> <span class="va">.draw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/spaghetti-1.png" width="648"></p>
<p>We can summarize the data frame at each x position using <code><a href="../reference/point_interval.html">median_qi()</a></code> (or any other function in the <code><a href="../reference/point_interval.html">point_interval()</a></code> family):</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/point_interval.html">median_qi</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 10 x 7
##        x       y    .lower .upper .width .point .interval
##    &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
##  1    -4 -1.01   -3.71       1.61   0.95 median qi       
##  2    -3 -0.0149 -2.38       2.30   0.95 median qi       
##  3    -2  0.981  -1.14       3.07   0.95 median qi       
##  4    -1  2.00    0.000809   3.97   0.95 median qi       
##  5     0  2.99    1.07       4.94   0.95 median qi       
##  6     1  3.99    2.04       6.00   0.95 median qi       
##  7     2  4.99    2.88       7.14   0.95 median qi       
##  8     3  6.00    3.58       8.44   0.95 median qi       
##  9     4  7.00    4.25       9.81   0.95 median qi       
## 10     5  8.01    4.89      11.2    0.95 median qi</code></pre>
<p>Given data summarized like that above, we can then construct a line+ribbon chart using <code><a href="../reference/geom_lineribbon.html">geom_lineribbon()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/point_interval.html">median_qi</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_lineribbon.html">geom_lineribbon</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/one_ribbon-1.png" width="648"></p>
<p><code><a href="../reference/geom_lineribbon.html">geom_lineribbon()</a></code> automatically pulls in the <code>.width</code> column and maps it onto the <code>fill</code> aesthetic so that intervals of different widths get different colors. However, the result with just one interval is not great, as the default color scheme is quite dark with just one color. Let’s make two changes to improve the chart:</p>
<ol style="list-style-type: decimal">
<li>We will use the <code>.width</code> argument of <code><a href="../reference/point_interval.html">median_qi()</a></code> to generate multiple uncertainty bands (a 50%, 80%, and 95% band).</li>
<li>We will use <code><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer()</a></code> to get a nicer color scheme.</li>
</ol>
<p>The result looks like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/point_interval.html">median_qi</a></span><span class="op">(</span><span class="va">y</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.50</span>, <span class="fl">.80</span>, <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_lineribbon.html">geom_lineribbon</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/geom_lineribbon-1.png" width="648"></p>
</div>
<div id="lineribbons-on-sample-data" class="section level2">
<h2 class="hasAnchor">
<a href="#lineribbons-on-sample-data" class="anchor"></a>Lineribbons on sample data</h2>
<p>To apply lineribbons to sample data, we can also use <code><a href="../reference/stat_lineribbon.html">stat_lineribbon()</a></code> instead of summarizing the data first using <code><a href="../reference/point_interval.html">median_qi()</a></code> or <code><a href="../reference/point_interval.html">point_interval()</a></code>. This function does the summarization internally for you.</p>
<p>Taking the previous example, we can simply removing the lines that summarize the data first, and omit the aesthetic mappings onto <code>ymin</code> and <code>ymax</code>, which are automatically set by <code><a href="../reference/stat_lineribbon.html">stat_lineribbon()</a></code>. This simplifies the previous example considerably:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/stat_lineribbon.html">stat_lineribbon</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/stat_lineribbon-1.png" width="648"></p>
<p>The default <code>.width</code> setting of <code><a href="../reference/stat_lineribbon.html">stat_lineribbon()</a></code> is <code><a href="https://rdrr.io/r/base/c.html">c(.50, .80, .95)</a></code>, as can be seen in the results above. We can change this as well; for example:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/stat_lineribbon.html">stat_lineribbon</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.66</span>, <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/stat_lineribbon_width-1.png" width="648"></p>
</div>
<div id="lineribbons-on-analytical-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#lineribbons-on-analytical-distributions" class="anchor"></a>Lineribbons on analytical distributions</h2>
<p>Lineribbons can also be applied to analytical distributions. This use case often arises with confidence distributions describing uncertainty in a fit line; for an example, see the end of <code><a href="../articles/freq-uncertainty-vis.html">vignette("freq-uncertainty-vis")</a></code>. Here, we will look at a simpler example where we construct the distributions manually; here we’ll assume some variable <code>y</code> that is normally distributed conditional on <code>x</code> with mean <code>y_mean</code> and standard deviation <code>y_sd</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="va">analytical_df</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span>,
  y_mean <span class="op">=</span> <span class="fl">3</span> <span class="op">+</span> <span class="va">x</span>,
  y_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,
<span class="op">)</span>
<span class="va">analytical_df</span></pre></div>
<pre><code>## # A tibble: 10 x 3
##        x y_mean  y_sd
##    &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1    -4     -1  1.61
##  2    -3      0  1.38
##  3    -2      1  1.18
##  4    -1      2  1.05
##  5     0      3  1   
##  6     1      4  1.05
##  7     2      5  1.18
##  8     3      6  1.38
##  9     4      7  1.61
## 10     5      8  1.87</code></pre>
<p>We can visualize this conditional distribution with <code><a href="../reference/stat_lineribbon.html">stat_dist_lineribbon()</a></code> using <code><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html">distributional::dist_normal()</a></code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">analytical_df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, dist <span class="op">=</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html">dist_normal</a></span><span class="op">(</span><span class="va">y_mean</span>, <span class="va">y_sd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/stat_lineribbon.html">stat_dist_lineribbon</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/stat_dist_lineribbon-1.png" width="648"></p>
</div>
<div id="more-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#more-examples" class="anchor"></a>More examples</h2>
<p>For more examples of lineribbons, including multiple lineribbons in the same plot, see the examples at the end of <code><a href="../articles/freq-uncertainty-vis.html">vignette("freq-uncertainty-vis")</a></code>.</p>
</div>
<div id="curve-boxplots-aka-lineribbons-with-joint-intervals-or-curvewise-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#curve-boxplots-aka-lineribbons-with-joint-intervals-or-curvewise-intervals" class="anchor"></a>Curve boxplots (aka lineribbons with joint intervals or curvewise intervals)</h2>
<p>The above examples all calculate <em>conditional</em> intervals, either using <code><a href="../reference/point_interval.html">point_interval()</a></code> (directly or indirectly) or using quantiles of an analytical distribution. However, you may not always want conditional intervals.</p>
<p>Where <code><a href="../reference/point_interval.html">point_interval()</a></code> calculates <em>pointwise</em> intervals, or intervals <em>conditional</em> on each group, <code><a href="../reference/curve_interval.html">curve_interval()</a></code> calculates <em>joint</em> or <em>curvewise</em> intervals. In the literature these are also called <em>curve boxplots</em> (<a href="https://doi.org/10.1109/TVCG.2014.2346455">Mirzargar <em>et al.</em> 2014</a>, <a href="https://arxiv.org/abs/2007.05035">Juul <em>et al.</em> 2020</a>).</p>
<p>An example will help illustrate the difference between the two types of intervals. Consider the following set of curves, where each curve is assumed to be a “draw” from some distribution of curves, <span class="math inline">\(\mathbf{y} = f(\mathbf{x})\)</span>, where <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span> are vectors:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="va">k</span> <span class="op">=</span> <span class="fl">11</span> <span class="co"># number of curves</span>
<span class="va">n</span> <span class="op">=</span> <span class="fl">501</span>
<span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
    .draw <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span>,
    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">5</span>, length.out <span class="op">=</span> <span class="va">k</span><span class="op">)</span>,
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>,<span class="fl">15</span>,length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span>,
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mean</span>, <span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mean</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">.draw</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/curve_draws-1.png" width="648"></p>
<p>If one used one of the <code><a href="../reference/point_interval.html">point_interval()</a></code> functions to summarize this curve (such as <code><a href="../reference/point_interval.html">median_qi()</a></code>, <code><a href="../reference/point_interval.html">mean_qi()</a></code>, etc), it would calculate <em>pointwise</em> intervals:</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/point_interval.html">median_qi</a></span><span class="op">(</span><span class="va">y</span>, .width <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_lineribbon.html">geom_lineribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">.draw</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.15</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"50% pointwise intervals with point_interval()"</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/pointwise_ribbon-1.png" width="648"></p>
<p>The 50% <em>pointwise</em> interval calculated at (say) <span class="math inline">\(x = 1\)</span> would contain 50% of the draws from <span class="math inline">\(y|x=1\)</span>. At a different value of <span class="math inline">\(x\)</span>, say <span class="math inline">\(x = 2\)</span>, the 50% pointwise interval would also contain 50% of the draws from <span class="math inline">\(y|x = 2\)</span>. However, the specific draws contained in the interval for <span class="math inline">\(y|x=2\)</span> might be <em>different</em> draws from those contained in the interval for <span class="math inline">\(x|y=1\)</span>: if you trace any of the underlying curves, you will notice that each curve is included in some intervals and not included in others. Thus, the set of intervals—the ribbon—may not fully contain 50% of curves. Indeed, inspecting the above plot, the 50% ribbon contains <strong>none</strong> of the curves!</p>
<p>Depending on what type of inference we care about, this might be sufficient for our purposes: maybe we are interested just in what the outcome is likely to be at a given x value (a conditional inference), but we are not interested in joint inferences (e.g., what is the shape of the curve likely to look like?). However, if we <em>are</em> interested in such joint inferences, pointwise intervals can be misleading. The shape of the median curve, for example, looks nothing like any of the possible outcomes. The interval also does not include the maximum value of <em>any</em> of the underlying curves, which might cause us to conclude (incorrectly) that a value close to 1 is unlikely, when the exact opposite is the case (every curve touches 1).</p>
<p>One solution I like for such situations is to show spaghetti plots: just plot the underlying curves. This is a so-called <em>frequency framing</em> uncertainty visualization, and it tends to work fairly well. However, in some cases you may want a visual summary using intervals, in which case curvewise intervals could help. Using <code><a href="../reference/curve_interval.html">curve_interval()</a></code> instead of <code><a href="../reference/point_interval.html">point_interval()</a></code> or <code><a href="../reference/point_interval.html">median_qi()</a></code> calculates these:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/curve_interval.html">curve_interval</a></span><span class="op">(</span><span class="va">y</span>, .width <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_lineribbon.html">geom_lineribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">.draw</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.15</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"50% curvewise intervals with curve_interval()"</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/curvewise_ribbon-1.png" width="648"></p>
<p>Note how the 50% <em>curvewise</em> interval now contains half of the underlying curves, and the median curve <em>is</em> one of the underlying curves (so it is more representative of the curve shape we should expect). These intervals also cover the peaks of the curves, where the pointwise intervals did not.</p>
<p>An X% <em>curvewise</em> interval is calculated across all the curves by taking the top X% closest curves to the central curve, for some definition of “close” and “central”. The <code><a href="../reference/curve_interval.html">curve_interval()</a></code> function currently orders curves by mean halfspace depth, which is basically how close each curve is to the pointwise median in percentiles, on average.</p>
<p>Given the above, let’s see what more realistic curvewise intervals of the above example might look like by using a larger number of draws:</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="va">k</span> <span class="op">=</span> <span class="fl">1000</span> <span class="co"># number of curves</span>
<span class="va">large_df</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
    .draw <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span>,
    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">5</span>, length.out <span class="op">=</span> <span class="va">k</span><span class="op">)</span>,
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>,<span class="fl">15</span>,length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span>,
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mean</span>, <span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mean</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">pointwise_plot</span> <span class="op">=</span> <span class="va">large_df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/point_interval.html">median_qi</a></span><span class="op">(</span><span class="va">y</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.8</span>, <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"gray75"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_lineribbon.html">geom_lineribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"point_interval()"</span><span class="op">)</span>

<span class="va">curvewise_plot</span> <span class="op">=</span> <span class="va">large_df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/curve_interval.html">curve_interval</a></span><span class="op">(</span><span class="va">y</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.8</span>, <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"gray75"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_lineribbon.html">geom_lineribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"curve_interval()"</span><span class="op">)</span>

<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>,
  <span class="va">pointwise_plot</span>, <span class="va">curvewise_plot</span>
<span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/pointwise_curvewise-1.png" width="648"></p>
<p>Notice how the pointwise intervals miss out on the peaks of this distribution of curves. Even the 95% ribbon, which appears to reach up to the peaks, in fact falls slightly short. While this is a bit of a pathological example, it does demonstrate the potential shortcomings of pointwise intervals.</p>
<div id="limitations-of-curvewise-intervals" class="section level3">
<h3 class="hasAnchor">
<a href="#limitations-of-curvewise-intervals" class="anchor"></a>Limitations of curvewise intervals</h3>
<p>One challenge with curvewise intervals is that they can tend to be very conservative, especially at moderate-to-large intervals widths. Let’s bootstrap some LOESS fits to horsepower versus MPG in the <code>mtcars</code> dataset:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">n</span> <span class="op">=</span> <span class="fl">4000</span>
<span class="va">mpg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="va">mtcars_boot</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  .draw <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>,
  m <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">.draw</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span>
    <span class="va">hp</span> <span class="op">~</span> <span class="va">mpg</span>, 
    span <span class="op">=</span> <span class="fl">0.9</span>,
    <span class="co"># this lets us predict outside the range of the data</span>
    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.control.html">loess.control</a></span><span class="op">(</span>surface <span class="op">=</span> <span class="st">"direct"</span><span class="op">)</span>, 
    data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span><span class="va">mtcars</span>, prop <span class="op">=</span> <span class="fl">1</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>,
  hp <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">predict</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span><span class="op">)</span>,
  mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">m</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">hp</span>, <span class="va">mpg</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>This is a pretty naive approach, and definitely not a great way of analyzing this data, but it will illustrate the problems of some kinds of problems we might get with joint intervals. Let’s look at a spaghetti plot of just 400 draws from this bootstrap distribution first:</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="va">mtcars_boot</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.draw</span> <span class="op">&lt;</span> <span class="fl">400</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mpg</span>, y <span class="op">=</span> <span class="va">hp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">.draw</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/mtcars_spaghetti-1.png" width="648"></p>
<p>Now, pointwise intervals:</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="va">mtcars_boot</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mpg</span>, y <span class="op">=</span> <span class="va">hp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/stat_lineribbon.html">stat_lineribbon</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.7</span>, <span class="fl">.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/mtcars_point_interval-1.png" width="648"></p>
<p>Finally, curvewise intervals:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="va">mtcars_boot</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/curve_interval.html">curve_interval</a></span><span class="op">(</span><span class="va">hp</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.7</span>, <span class="fl">.9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mpg</span>, y <span class="op">=</span> <span class="va">hp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_lineribbon.html">geom_lineribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/mtcars_curve_interval-1.png" width="648"></p>
<p>Notice how noisy the curvewise intervals are. In addition, because a number of curves tend to start low and end high (or vice versa), above 50%, the bands rapidly expand to cover almost all of the curves in the sample, regardless of coverage level. You can try different methods to sometimes get improved bands; e.g. using the <code>"bd-mbd"</code> method per Sun and Genton (<a href="https://doi.org/10.1198/jcgs.2011.09224">2011</a>) works better on this dataset:</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="va">mtcars_boot</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/curve_interval.html">curve_interval</a></span><span class="op">(</span><span class="va">hp</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.7</span>, <span class="fl">.9</span><span class="op">)</span>, .interval <span class="op">=</span> <span class="st">"bd-mbd"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mpg</span>, y <span class="op">=</span> <span class="va">hp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_lineribbon.html">geom_lineribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="lineribbon_files/figure-html/mtcars_curve_interval_bd-1.png" width="648"></p>
<p>In general I have found that there is no one method that consistently works well on all datasets. No matter the method, intervals often become problematic above 50%, hence the default <code>.width</code> for <code><a href="../reference/curve_interval.html">curve_interval()</a></code> is <code>0.5</code> (unlike the default for <code><a href="../reference/point_interval.html">point_interval()</a></code>, which is <code>0.95</code>). In any case, caution when using these intervals is advised.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://www.mjskay.com">Matthew Kay</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
